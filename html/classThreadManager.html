<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>Xmipp: ThreadManager Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="xmipp_logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Xmipp
   &#160;<span id="projectnumber">v20.07</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="inherits.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-attribs">Public Attributes</a> &#124;
<a href="#friends">Friends</a> &#124;
<a href="classThreadManager-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">ThreadManager Class Reference<div class="ingroups"><a class="el" href="group__Threads.html">Threads</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;<a class="el" href="xmipp__threads_8h_source.html">xmipp_threads.h</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:af82320acc085c6c7f1ee568278d54f99"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classThreadManager.html#af82320acc085c6c7f1ee568278d54f99">setData</a> (void *data, int nThread=-1)</td></tr>
<tr class="separator:af82320acc085c6c7f1ee568278d54f99"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a72682347d7f16f94013d5d48c27641ff"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classThreadManager.html#a72682347d7f16f94013d5d48c27641ff">ThreadManager</a> (int numberOfThreads, void *workClass=NULL)</td></tr>
<tr class="separator:a72682347d7f16f94013d5d48c27641ff"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a18eb12d3d752075318c3672c8efffd5b"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classThreadManager.html#a18eb12d3d752075318c3672c8efffd5b">~ThreadManager</a> ()</td></tr>
<tr class="separator:a18eb12d3d752075318c3672c8efffd5b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afd48602d0778461e6bb6d4de4a98b3e9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classThreadManager.html#afd48602d0778461e6bb6d4de4a98b3e9">run</a> (<a class="el" href="xmipp__threads_8h.html#a719f5cb6c585e459a293b84a77f8d4c6">ThreadFunction</a> function, void *data=NULL)</td></tr>
<tr class="separator:afd48602d0778461e6bb6d4de4a98b3e9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af432c205f59774de0d556962794519c2"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classThreadManager.html#af432c205f59774de0d556962794519c2">runAsync</a> (<a class="el" href="xmipp__threads_8h.html#a719f5cb6c585e459a293b84a77f8d4c6">ThreadFunction</a> function, void *data=NULL)</td></tr>
<tr class="separator:af432c205f59774de0d556962794519c2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9379b5dc55ef129de3aeed11cf806b2e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classThreadManager.html#a9379b5dc55ef129de3aeed11cf806b2e">wait</a> ()</td></tr>
<tr class="separator:a9379b5dc55ef129de3aeed11cf806b2e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9fc0cc1e0c5ad10a345b3f338b6835e4"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classThreadManager.html#a9fc0cc1e0c5ad10a345b3f338b6835e4">getNumberOfThreads</a> ()</td></tr>
<tr class="separator:a9fc0cc1e0c5ad10a345b3f338b6835e4"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-attribs"></a>
Public Attributes</h2></td></tr>
<tr class="memitem:a6525c2e9fcc12a9668c7145aaf92df4c"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classThreadManager.html#a6525c2e9fcc12a9668c7145aaf92df4c">threads</a></td></tr>
<tr class="memdesc:a6525c2e9fcc12a9668c7145aaf92df4c"><td class="mdescLeft">&#160;</td><td class="mdescRight">number of working threads.  <a href="#a6525c2e9fcc12a9668c7145aaf92df4c">More...</a><br /></td></tr>
<tr class="separator:a6525c2e9fcc12a9668c7145aaf92df4c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="friends"></a>
Friends</h2></td></tr>
<tr class="memitem:ad6c90109e4715c8f23d6b307eb12ef0f"><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classThreadManager.html#ad6c90109e4715c8f23d6b307eb12ef0f">_threadMain</a> (void *data)</td></tr>
<tr class="separator:ad6c90109e4715c8f23d6b307eb12ef0f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Class for manage a group of threads performing one or several tasks. This class is very useful when we have some function that can be executed in parallel by threads. The threads are created in the contructor of the object and released in destructor. This way threads can execute different functions at diffent moments and exit at the end of manager life. Also, the <a class="el" href="classThreadManager.html#a9379b5dc55ef129de3aeed11cf806b2e">wait()</a> function allow in the main thread to wait until all threads have finish working on a task and maybe then execute another one. This class is supposed to be used only in the main thread. </p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="a72682347d7f16f94013d5d48c27641ff"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">ThreadManager::ThreadManager </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>numberOfThreads</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>workClass</em> = <code>NULL</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Constructor, number of working threads should be supplied </p>

</div>
</div>
<a class="anchor" id="a18eb12d3d752075318c3672c8efffd5b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">ThreadManager::~ThreadManager </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Destructor, free memory and exit threads </p>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="a9fc0cc1e0c5ad10a345b3f338b6835e4"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int ThreadManager::getNumberOfThreads </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Get number of threads </p>

</div>
</div>
<a class="anchor" id="afd48602d0778461e6bb6d4de4a98b3e9"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ThreadManager::run </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="xmipp__threads_8h.html#a719f5cb6c585e459a293b84a77f8d4c6">ThreadFunction</a>&#160;</td>
          <td class="paramname"><em>function</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em> = <code>NULL</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Function to start working in a task. The function that you want to execute in parallel by the working threads should be passed as argument. If data is passed, then it is set to all threads. Functions that can be executed by thread should by of the type ThreadFunction, i.e., return void * and only one argument of type <a class="el" href="classThreadArgument.html">ThreadArgument</a>. The call of this function will block the main thread until all workers finish their job, if you don't want to block use runAsync instead, and later can call wait for waiting until threads are done. </p><div class="fragment"><div class="line"><span class="comment">//Global variables, so it are visible in &#39;processSeveralImages()&#39;</span></div><div class="line"><a class="code" href="classParallelTaskDistributor.html">ParallelTaskDistributor</a> * td;</div><div class="line"><span class="comment">//function to perform some operation</span></div><div class="line"><span class="comment">//to N images executed in parellel</span></div><div class="line"><span class="keywordtype">void</span> * processImages(<a class="code" href="classThreadArgument.html">ThreadArgument</a> &amp; data)</div><div class="line">{</div><div class="line">    <span class="keywordtype">int</span> thread_id = arg.thread_id;</div><div class="line"></div><div class="line">    <span class="keywordtype">size_t</span> firstImage, lastImage;</div><div class="line">    <span class="keywordflow">while</span> (td-&gt;<a class="code" href="classParallelTaskDistributor.html#a28f70bcc333b8b06d7571db06c67bdc3">getTasks</a>(firstImage, lastImage))</div><div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> image = firstImage; image &lt;= lastImage; ++image)</div><div class="line">        {</div><div class="line">            <span class="comment">//...</span></div><div class="line">            processOneImage(image);</div><div class="line">            <span class="comment">//...</span></div><div class="line">        }</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> <a class="code" href="example_8cpp.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a>()</div><div class="line">{</div><div class="line"><span class="comment">//...</span></div><div class="line"><span class="comment">//Distribute 1000 tasks in blocks of 100.</span></div><div class="line">td = <span class="keyword">new</span> <a class="code" href="classThreadTaskDistributor.html">ThreadTaskDistributor</a>(1000, 100);</div><div class="line"><span class="comment">//Start 2 threads to work on it</span></div><div class="line"><a class="code" href="classThreadManager.html">ThreadManager</a> * tm = <span class="keyword">new</span> <a class="code" href="classThreadManager.html#a72682347d7f16f94013d5d48c27641ff">ThreadManager</a>(2);</div><div class="line">tm.<a class="code" href="classThreadManager.html#afd48602d0778461e6bb6d4de4a98b3e9">run</a>(processImages);</div><div class="line"><span class="comment">//...</span></div><div class="line"><span class="comment">//Same threads can work in other function</span></div><div class="line">tm.<a class="code" href="classThreadManager.html#afd48602d0778461e6bb6d4de4a98b3e9">run</a>(processVolumes);</div><div class="line">}</div></div><!-- fragment --> 
</div>
</div>
<a class="anchor" id="af432c205f59774de0d556962794519c2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ThreadManager::runAsync </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="xmipp__threads_8h.html#a719f5cb6c585e459a293b84a77f8d4c6">ThreadFunction</a>&#160;</td>
          <td class="paramname"><em>function</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em> = <code>NULL</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Same as run but without blocking. </p>

</div>
</div>
<a class="anchor" id="af82320acc085c6c7f1ee568278d54f99"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ThreadManager::setData </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nThread</em> = <code>-1</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Set data for working threads. If nThread = -1 then data is set for all threads. </p>

</div>
</div>
<a class="anchor" id="a9379b5dc55ef129de3aeed11cf806b2e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ThreadManager::wait </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Function that should be called to wait until all threads finished work </p>

</div>
</div>
<h2 class="groupheader">Friends And Related Function Documentation</h2>
<a class="anchor" id="ad6c90109e4715c8f23d6b307eb12ef0f"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void* _threadMain </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">friend</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>function to start running the threads. Should be external and declared as friend</p>
<p>This function is used in <a class="el" href="classThreadManager.html">ThreadManager</a> as the main threads function to live in. </p>

</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a class="anchor" id="a6525c2e9fcc12a9668c7145aaf92df4c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ThreadManager::threads</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>number of working threads. </p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>/home/yunior/Yunior/Projects/Scipion/COSS/xmipp-bundle/src/xmippCore/core/<a class="el" href="xmipp__threads_8h_source.html">xmipp_threads.h</a></li>
<li>/home/yunior/Yunior/Projects/Scipion/COSS/xmipp-bundle/src/xmippCore/core/<a class="el" href="xmipp__threads_8cpp.html">xmipp_threads.cpp</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
